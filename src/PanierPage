package view;

import controller.PanierController;
import model.PanierItem;
import model.User;
import util.Session;

import javax.swing.*;
import java.awt.*;
import java.util.List;

public class PanierPage extends JFrame {
    private JPanel panierPanel;
    private List<PanierItem> panierItems;
    private double totalPanier = 0;

    public PanierPage(List<PanierItem> panierItems) {
        this.panierItems = panierItems;

        setTitle("Mon Panier");
        setSize(500, 400);
        setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);
        setLayout(new BorderLayout());

        panierPanel = new JPanel();
        panierPanel.setLayout(new BoxLayout(panierPanel, BoxLayout.Y_AXIS));
        add(new JScrollPane(panierPanel), BorderLayout.CENTER);

        loadPanierItems();

        JButton validerCommandeButton = new JButton("Valider la commande");
        validerCommandeButton.addActionListener(e -> {
            User user = Session.get();
            if (PanierController.validerCommande(panierItems, user)) {
                dispose(); // ferme la fenêtre actuelle
                EcranPayement.lancerPaiement(() -> {
                    JOptionPane.showMessageDialog(null, "Commande confirmée et payée !");
                });
            }
        });

        add(validerCommandeButton, BorderLayout.SOUTH);
        setVisible(true);
    }
