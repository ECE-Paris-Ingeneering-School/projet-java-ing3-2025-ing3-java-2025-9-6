package view;

import controller.PanierController;
import model.PanierItem;
import model.User;
import util.Session;

import javax.swing.*;
import java.awt.*;
import java.util.List;

public class PanierPage extends JFrame {
    private JPanel panierPanel;
    private List<PanierItem> panierItems;
    private double totalPanier = 0;

    public PanierPage(List<PanierItem> panierItems) {
        this.panierItems = panierItems;

        setTitle("Mon Panier");
        setSize(500, 400);
        setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);
        setLayout(new BorderLayout());

        panierPanel = new JPanel();
        panierPanel.setLayout(new BoxLayout(panierPanel, BoxLayout.Y_AXIS));
        add(new JScrollPane(panierPanel), BorderLayout.CENTER);

        loadPanierItems();

        JButton validerCommandeButton = new JButton("Valider la commande");
        validerCommandeButton.addActionListener(e -> {
            User user = Session.get();
            if (PanierController.validerCommande(panierItems, user)) {
                dispose(); // ferme la fenÃªtre actuelle
                EcranPayement.lancerPaiement(() -> {
                    JOptionPane.showMessageDialog(null, "Commande confirmÃ©e et payÃ©e !");
                });
            }
        });

        add(validerCommandeButton, BorderLayout.SOUTH);
        setVisible(true);
    }

    private void loadPanierItems() {
        totalPanier = 0;
        panierPanel.removeAll();

        if (panierItems.isEmpty()) {
            panierPanel.add(new JLabel("Votre panier est vide."));
        } else {
            for (PanierItem item : panierItems) {
                double total = item.calculerPrixTotal();
                totalPanier += total;
                String itemInfo = item.getNom() + " (PU: " + item.getPrixUnitaire() +
                        "â‚¬, QtÃ©: " + item.getQuantite() + ") âžœ Total: " +
                        String.format("%.2f", total) + "â‚¬";
                panierPanel.add(new JLabel(itemInfo));
            }
            panierPanel.add(Box.createVerticalStrut(10));
            panierPanel.add(new JLabel("ðŸ’° Total du panier: " + totalPanier + "â‚¬"));
        }

        panierPanel.revalidate();
        panierPanel.repaint();
    }
}
